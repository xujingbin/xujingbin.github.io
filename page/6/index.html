<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="运维笔记" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="个人运维笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="运维笔记">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;6&#x2F;index.html">
<meta property="og:site_name" content="运维笔记">
<meta property="og:description" content="个人运维笔记">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>运维笔记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">运维笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">56</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">47</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">76</span></a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/27/ansible/useradd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/27/ansible/useradd/" class="post-title-link" itemprop="url">ansible添加用户</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-27 11:28:13" itemprop="dateCreated datePublished" datetime="2019-11-27T11:28:13+08:00">2019-11-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ansible/" itemprop="url" rel="index">
                    <span itemprop="name">ansible</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>运维需要管理许多开发人员的pub文件，统一存储在/etc/ansible/user.keypubs/.id_rsa.pub下，</li>
<li>/etc/ansible/useradd.yml文件，添加zhangsan用户，只需修改vars下的用户、组名和执行的机器组hosts<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: centos6</span><br><span class="line">  remote_user: dinggel</span><br><span class="line">  gather_facts: false</span><br><span class="line">  become: yes</span><br><span class="line">  vars:</span><br><span class="line">    - &#123;name: zhangsan, group: zhangsan&#125;</span><br><span class="line">  tasks:</span><br><span class="line">    - name: user add</span><br><span class="line">      user: name=&#123;&#123; name &#125;&#125;</span><br><span class="line">    - name: mkdir /home/&#123;&#123; name &#125;&#125;/.ssh</span><br><span class="line">      file: path=/home/&#123;&#123; name &#125;&#125;/.ssh state=directory owner=&#123;&#123; name &#125;&#125; mode=0700</span><br><span class="line">    - name: user add</span><br><span class="line">      action: file path=/home/&#123;&#123; name &#125;&#125;/.ssh/authorized_keys state=touch  owner=&#123;&#123; name &#125;&#125; mode=0600</span><br><span class="line"></span><br><span class="line">    - name: ssh-copy</span><br><span class="line">      authorized_key:</span><br><span class="line">        user: &quot;&#123;&#123; name &#125;&#125;&quot;</span><br><span class="line">        key: &quot;&#123;&#123; lookup(&apos;file&apos;, &apos;/etc/ansible/user.keypubs/&#123;&#123; name &#125;&#125;.id_rsa.pub&apos;) &#125;&#125;&quot;</span><br><span class="line">        path: /home/&#123;&#123; name &#125;&#125;/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/20/db/etcd/confd+etcd+haproxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/20/db/etcd/confd+etcd+haproxy/" class="post-title-link" itemprop="url">db/etcd/confd+etcd+haproxy</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-08-20 14:52:13 / 修改时间：14:52:40" itemprop="dateCreated datePublished" datetime="2019-08-20T14:52:13+08:00">2019-08-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="confd"><a href="#confd" class="headerlink" title="confd"></a>confd</h1><p><a href="https://github.com/kelseyhightower/confd" target="_blank" rel="noopener">https://github.com/kelseyhightower/confd</a></p>
<h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p><a href="https://github.com/kelseyhightower/confd/blob/master/docs/templates.md" target="_blank" rel="noopener">https://github.com/kelseyhightower/confd/blob/master/docs/templates.md</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/db/etcd/%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/15/db/etcd/%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/" class="post-title-link" itemprop="url">db/etcd/备份恢复</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-15 11:22:55" itemprop="dateCreated datePublished" datetime="2019-08-15T11:22:55+08:00">2019-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-12 19:27:12" itemprop="dateModified" datetime="2019-11-12T19:27:12+08:00">2019-11-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p>官方指出 etcd v2 和 v3 的数据不能混合存放，<a href="https://github.com/etcd-io/etcd/issues/7002" target="_blank" rel="noopener">support backup of v2 and v3 stores</a> 。</p>
<p>特别提醒：若使用 v3 备份数据时存在 v2 的数据则不影响恢复<br>若使用 v2 备份数据时存在 v3 的数据则恢复失败<br>etcd 集群都是至少 3 台机器，官方也说明了集群容错为 (N-1)/2，所以备份数据一般都是用不到，但是鉴上次 gitlab 出现的问题，对于备份数据也要非常重视。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 开发环境 备份脚本在/crond</span><br><span class="line"></span><br><span class="line">IP=192.168.67.201</span><br><span class="line">BACKUP_DIR=/usr/local/backup</span><br><span class="line">mkdir -p $BACKUP_DIR</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">/usr/local/etcd-v3.2.26-linux-amd64/bin/etcdctl --endpoints=http://$IP:2379 snapshot save $BACKUP_DIR/snap-$(date +%Y%m%d%H%M).db</span><br><span class="line">find $BACKUP_DIR -mtime +7 |xargs rm -f</span><br><span class="line"></span><br><span class="line"># 备份一个节点的数据就可以恢复，实践中，为了防止定时任务配置的节点异常没有生成备份，建议多加几个</span><br></pre></td></tr></table></figure>

<h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><h2 id="集群单节点故障恢复"><a href="#集群单节点故障恢复" class="headerlink" title="集群单节点故障恢复"></a>集群单节点故障恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 查看故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS endpoint health</span><br><span class="line">2. 查看节点id</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member list</span><br><span class="line">3. 删除故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member remove 81672b0117eb8ad9</span><br><span class="line">4. 下线故障节点，并删除data目录</span><br><span class="line">systemctl stop etcd</span><br><span class="line">5. 添加新节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member add etcd-2 --peer-urls=http://192.168.67.202:2380</span><br><span class="line">6. 修改新节点配置文件</span><br><span class="line">/usr/local/etcd-v3.2.26-linux-amd64/conf/cluster</span><br><span class="line">CLUSTER_STATE=existing</span><br><span class="line">7. 启动新节点systemctl start etcd</span><br></pre></td></tr></table></figure>
<h2 id="单节点备份恢复"><a href="#单节点备份恢复" class="headerlink" title="单节点备份恢复"></a>单节点备份恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BACKUP_DIR=.</span><br><span class="line">#mkdir -p $BACKUP_DIR</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">#etcdctl --endpoints=http://$IP:2379 snapshot save $BACKUP_DIR/snap.db</span><br><span class="line">##find $BACKUP_DIR -mtime +7 |xargs rm -f</span><br><span class="line">#etcdctl --endpoints=&apos;172.20.7.15:2379&apos; snapshot restore $BACKUP_DIR/snap.db --data-dir=&quot;/data2/etcd/&quot;</span><br><span class="line">#etcdctl --endpoints=&apos;172.20.7.15:2379&apos; snapshot status snap.db --write-out=table</span><br><span class="line">etcdctl --endpoints=&apos;172.20.6.123:2379&apos;  get / --prefix --keys-only</span><br><span class="line">echo &quot;---------&quot;</span><br><span class="line">etcdctl --endpoints=&apos;172.20.2.118:2379&apos;  get / --prefix --keys-only</span><br></pre></td></tr></table></figure>
<h2 id="根据快照恢复集群"><a href="#根据快照恢复集群" class="headerlink" title="根据快照恢复集群"></a>根据快照恢复集群</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 使用 etcdctl snapshot restore 生成各个节点的数据</span><br><span class="line"></span><br><span class="line"># 比较关键的变量是</span><br><span class="line"># --data-dir 需要是实际 etcd 运行时的数据目录</span><br><span class="line"># --name  --initial-advertise-peer-urls  需要用各个节点的配置</span><br><span class="line"># --initial-cluster  initial-cluster-token 需要和原集群一致</span><br><span class="line"># 本节点 --name etcd-1</span><br><span class="line"></span><br><span class="line">ETCD_1=192.168.67.54</span><br><span class="line">ETCD_2=192.168.67.55</span><br><span class="line">ETCD_3=192.168.67.56</span><br><span class="line">cd /usr/local/etcd-v3.2.26-linux-amd64</span><br><span class="line">for i in ETCD_1 ETCD_2 ETCD_3</span><br><span class="line">do</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">bin/etcdctl snapshot restore snapshot.db \</span><br><span class="line">--data-dir=/data \</span><br><span class="line">--name $i \</span><br><span class="line">--initial-cluster $&#123;ETCD_1&#125;=http://$&#123;ETCD_1&#125;:2380,$&#123;ETCD_2&#125;=http://$&#123;ETCD_2&#125;:2380,$&#123;ETCD_3&#125;=http://$&#123;ETCD_3&#125;:2380 \</span><br><span class="line">--initial-cluster-token token-cluster-test-82788fef \</span><br><span class="line">--initial-advertise-peer-urls http://$i:2380 &amp;&amp; \</span><br><span class="line">mv data etcd_$i</span><br><span class="line"></span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">把生成的data目录 复制到其他节点</span><br></pre></td></tr></table></figure>

<h1 id="参考文本"><a href="#参考文本" class="headerlink" title="参考文本"></a>参考文本</h1><p><a href="https://www.jianshu.com/p/c60c08effaaa" target="_blank" rel="noopener">https://www.jianshu.com/p/c60c08effaaa</a><br><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/recovery.md" target="_blank" rel="noopener">https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/recovery.md</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/logging/fluentd-k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/15/logging/fluentd-k8s/" class="post-title-link" itemprop="url">fluented容器安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-15 10:04:24" itemprop="dateCreated datePublished" datetime="2019-08-15T10:04:24+08:00">2019-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-27 16:33:41" itemprop="dateModified" datetime="2019-11-27T16:33:41+08:00">2019-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/fluentd/" itemprop="url" rel="index">
                    <span itemprop="name">fluentd</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="fluentd-install"><a href="#fluentd-install" class="headerlink" title="fluentd install"></a>fluentd install</h1><p><a href="https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch" target="_blank" rel="noopener">参考官方文档</a></p>
<ol>
<li><p>下载文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kubernetes/kubernetes/master/cluster/addons/fluentd-elasticsearch/fluentd-es-configmap.yaml</span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/kubernetes/master/cluster/addons/fluentd-elasticsearch/fluentd-es-ds.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改fluentd-es-ds.yaml文件,两处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">volumeMounts:</span><br><span class="line">- name: varlibdockercontainers</span><br><span class="line">  mountPath: /var/lib/docker/containers</span><br><span class="line">  readOnly: true</span><br><span class="line">volumes:</span><br><span class="line">....</span><br><span class="line">  - name: varlibdockercontainers</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /var/log/docker/containers</span><br><span class="line">改为(对docker存储目录有做修改)</span><br><span class="line">- name: varlibdockercontainers</span><br><span class="line">  mountPath: /data/docker/containers</span><br><span class="line">  readOnly: true</span><br><span class="line">  </span><br><span class="line">  - name: varlibdockercontainers</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/docker/containers</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署到集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f fluentd-es-configmap.yaml</span><br><span class="line">kubectl apply -f fluentd-es-ds.yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>另附外部service yaml文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># es-ep.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Endpoints</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    kubernetes.io/cluster-service: &quot;true&quot;</span><br><span class="line">    kubernetes.io/name: Elasticsearch</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  namespace: kube-system</span><br><span class="line">subsets:</span><br><span class="line">- addresses:</span><br><span class="line">  - ip: 192.168.67.114</span><br><span class="line">  ports:</span><br><span class="line">  - port: 9200</span><br><span class="line">    protocol: TCP</span><br><span class="line"># es-svc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    kubernetes.io/cluster-service: &quot;true&quot;</span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">    kubernetes.io/name: &quot;Elasticsearch&quot;</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 9200</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 9200</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/14/db/es/backup-restore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/14/db/es/backup-restore/" class="post-title-link" itemprop="url">db/es/backup-restore</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-14 09:37:19" itemprop="dateCreated datePublished" datetime="2019-08-14T09:37:19+08:00">2019-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-15 11:14:46" itemprop="dateModified" datetime="2019-08-15T11:14:46+08:00">2019-08-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="es备份-恢复"><a href="#es备份-恢复" class="headerlink" title="es备份 恢复"></a>es备份 恢复</h1><h2 id="es集群支持多副本高可用"><a href="#es集群支持多副本高可用" class="headerlink" title="es集群支持多副本高可用"></a>es集群支持多副本高可用</h2><h2 id="物理备份直接备份data文件夹和应用文件夹"><a href="#物理备份直接备份data文件夹和应用文件夹" class="headerlink" title="物理备份直接备份data文件夹和应用文件夹"></a>物理备份直接备份data文件夹和应用文件夹</h2><p>目前只备份应用配置文件elasticsearch.yml jvm.options kibana.yml到/data/backup</p>
<h2 id="逻辑备份方式对比snapshot-vs-elasticdump"><a href="#逻辑备份方式对比snapshot-vs-elasticdump" class="headerlink" title="逻辑备份方式对比snapshot vs elasticdump"></a>逻辑备份方式对比snapshot vs elasticdump</h2><p>  elasticdump will simply scan one index in your remote ES cluster and will either dump the JSON data into a file it can then replay to rebuild the index in the same or some other ES instance (remote or local).<br>elasticdump can also store the data it pumps from your remote ES directly into your local instance (instead of storing the data into a file).<br>Snapshot/restore is the official way of backuping your index data. There are various targets (filesystem, S3, etc), but the main idea is that you do a first snapshot and then all subsequent snapshots will be incremental, i.e. the snapshot process will only store what has changed since the last run.<br>In your case, you can go either way, but using elasticdump is straightforward if all you want to do is to have a local copy of your production data.</p>
<p>note：elasticdump操作性更强，可直接在不同版本，不同es之间直接导数据，备份json文件，官方snapshot则支持增量备份，备份到不同文件系统中。具体性能对比未测试</p>
<h2 id="elasticdump插件"><a href="#elasticdump插件" class="headerlink" title="elasticdump插件"></a>elasticdump插件</h2><p>官网安装<a href="https://www.npmjs.com/package/elasticdump" target="_blank" rel="noopener">https://www.npmjs.com/package/elasticdump</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elasticdump --help</span><br><span class="line">elasticdump \</span><br><span class="line">  --input=http://172.16.12.21:9200/logstash-2019.08.04 \</span><br><span class="line">  --output=http://192.168.67.111:9200/logstash-2019.08.04 \</span><br><span class="line">  --type=data</span><br></pre></td></tr></table></figure>
<h2 id="snapshot"><a href="#snapshot" class="headerlink" title="snapshot"></a>snapshot</h2><h3 id="创建备份仓库"><a href="#创建备份仓库" class="headerlink" title="创建备份仓库"></a>创建备份仓库</h3><p>在elasticsearch.yml增加<code>path.repo: [&quot;/data/es_backup&quot;]</code>，创建备份目录/data/backup/，chown es:es /data/backup/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在kibana上操作</span><br><span class="line"> 创建仓库</span><br><span class="line">PUT /_snapshot/backup</span><br><span class="line">&#123;</span><br><span class="line">  &quot;type&quot;: &quot;fs&quot;,</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;location&quot;: &quot;/data/backup/all&quot;,</span><br><span class="line">    &quot;compress&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> 查看仓库</span><br><span class="line"> GET /_snapshot</span><br></pre></td></tr></table></figure>
<h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">执行备份全部索引</span><br><span class="line">PUT /_snapshot/backup/all</span><br><span class="line">查看所有备份</span><br><span class="line">GET /_snapshot/backup/_all</span><br><span class="line">查看备份状态</span><br><span class="line">GET /_snapshot/_status</span><br><span class="line">8.15日上午10：59分备份36个索引，47,214,397个文档，30.7GB，11：11分结束,耗时12分钟左右</span><br><span class="line">删除备份</span><br><span class="line">DELETE /_snapshot/backup/all</span><br></pre></td></tr></table></figure>
<h3 id="恢复备份"><a href="#恢复备份" class="headerlink" title="恢复备份"></a>恢复备份</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">恢复所有备份</span><br><span class="line">POST /_snapshot/backup/all/_restore</span><br><span class="line">只恢复部分索引</span><br><span class="line">POST /_snapshot/backup/all/_restore</span><br><span class="line">&#123;</span><br><span class="line">    &quot;indices&quot;: &quot;logstash-2019.08.04&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="文档参考"><a href="#文档参考" class="headerlink" title="文档参考"></a>文档参考</h2><p><a href="https://blog.51cto.com/landanhero/1912049" target="_blank" rel="noopener">https://blog.51cto.com/landanhero/1912049</a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/modules-snapshots.html#_version_compatibility" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.3/modules-snapshots.html#_version_compatibility</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/13/k8s/%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/13/k8s/%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/" class="post-title-link" itemprop="url">k8s/备份和还原</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-08-13 15:19:59 / 修改时间：16:44:21" itemprop="dateCreated datePublished" datetime="2019-08-13T15:19:59+08:00">2019-08-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p>Kubernetes的备份主要是通过ETCD的备份完成的。而恢复时，主要考虑的是整个顺序：停止kube-apiserver，停止ETCD，恢复数据，启动ETCD，启动kube-apiserver。</p>
<h2 id="etcd-backup-sh"><a href="#etcd-backup-sh" class="headerlink" title="etcd-backup.sh"></a>etcd-backup.sh</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 该脚本放在192.168.67.119 /crond/etcd-backup.sh，每天执行两次</span><br><span class="line">IP=127.0.0.1</span><br><span class="line">BACKUP_DIR=/usr/local/backup/etcd</span><br><span class="line">mkdir -p $BACKUP_DIR</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">etcdctl --endpoints=https://$IP:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot save $BACKUP_DIR/snap-$(date +%Y%m%d%H%M).db</span><br><span class="line">find $BACKUP_DIR -mtime +7 |xargs rm -f</span><br><span class="line">scp $BACKUP_DIR/snap-$(date +%Y%m%d%H%M).db 192.168.67.120:/usr/local/backup/etcd/</span><br></pre></td></tr></table></figure>
<h2 id="捕鱼2应用yaml文件备份"><a href="#捕鱼2应用yaml文件备份" class="headerlink" title="捕鱼2应用yaml文件备份"></a>捕鱼2应用yaml文件备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 该脚本放在192.168.67.119 /crond/buyu2-backup.sh，每天执行两次</span><br><span class="line">cd /usr/local/backup/buyu2/</span><br><span class="line">for name in `kubectl get deploy -n game-buyu |awk &apos;$1!~/NAME/ &#123;print $1&#125;&apos;`;do</span><br><span class="line">  kubectl -n game-buyu get deploy $&#123;name&#125; -o yaml &gt; $&#123;name&#125;-ds.yaml</span><br><span class="line">done</span><br><span class="line">for name in `kubectl get service -n game-buyu |awk &apos;$1!~/NAME/ &#123;print $1&#125;&apos;`;do</span><br><span class="line">  kubectl -n game-buyu get service $name -o yaml &gt; $&#123;name&#125;-svc.yaml</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2 id="etc-kubernetes与-var-lib-kubelet-都备份到-usr-local-backup目录下"><a href="#etc-kubernetes与-var-lib-kubelet-都备份到-usr-local-backup目录下" class="headerlink" title="/etc/kubernetes与/var/lib/kubelet/都备份到/usr/local/backup目录下"></a>/etc/kubernetes与/var/lib/kubelet/都备份到/usr/local/backup目录下</h2><h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><h2 id="kubernetes还原"><a href="#kubernetes还原" class="headerlink" title="kubernetes还原"></a>kubernetes还原</h2><h3 id="首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了-执行下列命令返回值为0"><a href="#首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了-执行下列命令返回值为0" class="headerlink" title="首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了,执行下列命令返回值为0"></a>首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了,执行下列命令返回值为0</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/kubernetes/manifests-backups</span><br><span class="line">mv /etc/kubernetes/manifests/kube-apiserver.yaml /etc/kubernetes/manifests-backups/</span><br><span class="line">ps -ef|grep kube-api|grep -v grep |wc -l</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h3 id="停掉所有etcd节点并且移除ETCD数据目录"><a href="#停掉所有etcd节点并且移除ETCD数据目录" class="headerlink" title="停掉所有etcd节点并且移除ETCD数据目录"></a>停掉所有etcd节点并且移除ETCD数据目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/lib/etcd /var/lib/etcd-bak</span><br></pre></td></tr></table></figure>
<h3 id="分别在各个节点恢复数据-首先需要拷贝数据到每个master节点"><a href="#分别在各个节点恢复数据-首先需要拷贝数据到每个master节点" class="headerlink" title="分别在各个节点恢复数据,首先需要拷贝数据到每个master节点"></a>分别在各个节点恢复数据,首先需要拷贝数据到每个master节点</h3><h3 id="所有节点etcd数据恢复"><a href="#所有节点etcd数据恢复" class="headerlink" title="所有节点etcd数据恢复"></a>所有节点etcd数据恢复</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set -x</span><br><span class="line">export ETCD_NAME=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep  -o &apos;*--name=node[0-9]*&apos; |cut -d &apos;=&apos; -f 2)</span><br><span class="line">export ETCD_CLUSTER=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep   &apos;*--initial-clustere*&apos; |awk -F &apos;--initial-cluster=&apos; &apos;&#123;print $2&#125;&apos;)</span><br><span class="line">export ETCD_INITIAL_ADVERTISE_PEER_URLS=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep   &apos;*--initial-advertise-peer-urls*&apos; |awk -F &apos;--initial-advertise-peer-urls=&apos; &apos;&#123;print $2&#125;&apos;)</span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key  restore /var/lib/etcd_backup/backup_20180107172459.db \</span><br><span class="line">  --name $ETCD_NAME \</span><br><span class="line">  --data-dir /var/lib/etcd/ \</span><br><span class="line">  --initial-cluster $ETCD_CLUSTER \</span><br><span class="line">  --initial-advertise-peer-urls $ETCD_INITIAL_ADVERTISE_PEER_URLS</span><br></pre></td></tr></table></figure>
<h3 id="启动所有ETCD，健康检查"><a href="#启动所有ETCD，健康检查" class="headerlink" title="启动所有ETCD，健康检查"></a>启动所有ETCD，健康检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ETCDCTL_API=3 etcdctl --endpoints=&apos;https://127.0.0.1:2379&apos; --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key endpoint health</span><br></pre></td></tr></table></figure>
<h3 id="启动apiserver"><a href="#启动apiserver" class="headerlink" title="启动apiserver"></a>启动apiserver</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/kubernetes/manifests-backups/kube-apiserver.yaml /etc/kubernetes/manifests/</span><br><span class="line">kubectl get cs,node</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/db/etcd/etcd-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/22/db/etcd/etcd-issue/" class="post-title-link" itemprop="url">db/etcd/etcd-issue</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-22 18:25:50" itemprop="dateCreated datePublished" datetime="2019-07-22T18:25:50+08:00">2019-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-02 14:22:03" itemprop="dateModified" datetime="2019-08-02T14:22:03+08:00">2019-08-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="集群故障一个节点问题解决"><a href="#集群故障一个节点问题解决" class="headerlink" title="集群故障一个节点问题解决"></a>集群故障一个节点问题解决</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 查看故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS endpoint health</span><br><span class="line">2. 查看节点id</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member list</span><br><span class="line">3. 删除故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member remove 81672b0117eb8ad9</span><br><span class="line">4. 下线故障节点，并删除data目录</span><br><span class="line">systemctl stop etcd</span><br><span class="line">5. 添加新节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member add etcd-2 --peer-urls=http://192.168.67.202:2380</span><br><span class="line">6. 修改新节点配置文件</span><br><span class="line">/usr/local/etcd-v3.2.26-linux-amd64/conf/cluster</span><br><span class="line">CLUSTER_STATE=existing</span><br><span class="line">7. 启动新节点systemctl start etcd</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">etcdctl --endpoints=127.0.0.1:2379 --ca-file=ca.pem --cert-file=server.pem --key-file=server-key.pem member list</span><br></pre></td></tr></table></figure>
<h2 id="etcd-集群运维实践"><a href="#etcd-集群运维实践" class="headerlink" title="etcd 集群运维实践"></a>etcd 集群运维实践</h2><p><a href="https://www.kubernetes.org.cn/5021.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/5021.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/17/k8s/k8s%201.11.5%20%E5%8D%95%E4%B8%BB%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/17/k8s/k8s%201.11.5%20%E5%8D%95%E4%B8%BB%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">k8s/k8s 1.11.5 单主安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-17 17:38:05" itemprop="dateCreated datePublished" datetime="2019-07-17T17:38:05+08:00">2019-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-23 15:13:51" itemprop="dateModified" datetime="2019-07-23T15:13:51+08:00">2019-07-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h2><p>master 和 node都要执行该步骤</p>
<ol>
<li><p>基础环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">master: 192.168.67.109   node: 192.168.67.110</span><br><span class="line">hostnamectl set-hostname master</span><br><span class="line">cat &gt;&gt; /etc/resolv.conf &lt;&lt;EOF</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">EOF</span><br><span class="line">### 注意修改ＩＰ ###</span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">192.168.67.109 master</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>内核优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定数据盘<br>mkdir /etc/docker<br>mkdir -p /data/docker<br>需上传包目录deploy至 /data/deploy</p>
</li>
<li><p>关闭firewalld防火墙， 清空ipatbles</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">iptables -F</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">systemctl stop iptables &amp;&amp; systemctl disable iptables</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="master安装"><a href="#master安装" class="headerlink" title="master安装"></a>master安装</h2><ol>
<li><p>安装docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -ssL https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">yum -y install docker-ce-17.06.2.ce-1.el7.centos</span><br><span class="line">systemctl enable docker.service</span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;graph&quot;: &quot;/data/docker&quot;,</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://ry344jnm.mirror.aliyuncs.com&quot;,&quot;https://docker.mirrors.ustc.edu.cn&quot;, &quot;hub-mirror.c.163.com&quot;],</span><br><span class="line">  &quot;max-concurrent-downloads&quot;: 10,</span><br><span class="line">  &quot;bridge&quot;: &quot;none&quot;,</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.67.113&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装kubernetes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /etc/yum.repos.d/kubernetes.repo </span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br><span class="line">yum -y install kubelet-1.11.5-0 kubeadm-1.11.5-0 kubectl-1.11.5-0 kubernetes-cni-0.6.0</span><br><span class="line">systemctl enable kubelet.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/deploy</span><br><span class="line">./dockerload.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.11.5 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12</span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line">cd /data/deploy</span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line">kubectl get cs</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装组件包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl set image deployment/kubernetes-dashboard kubernetes-dashboard=mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.0 -n kube-system</span><br><span class="line">kubectl patch svc -n kube-system kubernetes-dashboard -p &apos;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&apos;</span><br><span class="line">kubectl create -f dashboard-admin.yaml</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="添加node节点"><a href="#添加node节点" class="headerlink" title="添加node节点"></a>添加node节点</h2><p>执行”master安装“步骤的1,2,3步，然后执行以下命令来加入集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.67.109:6443 --token iojvkj.1eqtapewld4i4t2p --discovery-token-ca-cert-hash sha256:195c5bcd6fadf51c39a7891b2dd9d87682f48d48ab0e7d567593ffbce225c8ec</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/docker-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/docker-install/" class="post-title-link" itemprop="url">k8s/docker-install</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:40:07" itemprop="dateCreated datePublished" datetime="2019-07-16T10:40:07+08:00">2019-07-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package" target="_blank" rel="noopener">docker-install</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"> yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>


<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/rbac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/rbac/" class="post-title-link" itemprop="url">k8s/rbac</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:31:09" itemprop="dateCreated datePublished" datetime="2019-07-16T10:31:09+08:00">2019-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-02 17:36:49" itemprop="dateModified" datetime="2019-08-02T17:36:49+08:00">2019-08-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h2><ol>
<li>kubectl的用户认证授权 <a href="https://www.colabug.com/1183751.html" target="_blank" rel="noopener">https://www.colabug.com/1183751.html</a></li>
<li>kubeconfig <a href="https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html" target="_blank" rel="noopener">https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html</a></li>
<li>calico <a href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/" target="_blank" rel="noopener">https://docs.projectcalico.org/v3.6/getting-started/kubernetes/</a></li>
<li>Kubernetes-基于RBAC的授权 <a href="https://www.kubernetes.org.cn/4062.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/4062.html</a></li>
<li>tls <a href="https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/" target="_blank" rel="noopener">https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/</a></li>
<li>dashboard 最小权限<a href="https://www.cnblogs.com/fuyuteng/p/9501079.html" target="_blank" rel="noopener">https://www.cnblogs.com/fuyuteng/p/9501079.html</a></li>
</ol>
<p>参考 <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a><br>对资源的权限</p>
<pre><code>- apiGroups:
  - extensions
对应deployment的apiVersion: extensions/v1beta1
resources:
- pods
- pods/attach
- pods/exec
对应各种资源
verbs:
- get
- list
- watch
对应操作权限 还有其他如  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xujingbin</p>
  <div class="site-description" itemprop="description">个人运维笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xujingbin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0
  </div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
