<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="运维笔记" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="个人运维笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="运维笔记">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;7&#x2F;index.html">
<meta property="og:site_name" content="运维笔记">
<meta property="og:description" content="个人运维笔记">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>运维笔记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">运维笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">65</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">59</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">83</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/13/k8s/%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/13/k8s/%E5%A4%87%E4%BB%BD%E5%92%8C%E8%BF%98%E5%8E%9F/" class="post-title-link" itemprop="url">k8s备份还原</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-13 15:19:59" itemprop="dateCreated datePublished" datetime="2019-08-13T15:19:59+08:00">2019-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-09 14:09:36" itemprop="dateModified" datetime="2019-12-09T14:09:36+08:00">2019-12-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F/" itemprop="url" rel="index">
                    <span itemprop="name">备份还原</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p>Kubernetes的备份主要是通过ETCD的备份完成的。而恢复时，主要考虑的是整个顺序：停止kube-apiserver，停止ETCD，恢复数据，启动ETCD，启动kube-apiserver。</p>
<h2 id="etcd-backup-sh"><a href="#etcd-backup-sh" class="headerlink" title="etcd-backup.sh"></a>etcd-backup.sh</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 该脚本放在192.168.67.119 /crond/etcd-backup.sh，每天执行两次</span><br><span class="line">IP=127.0.0.1</span><br><span class="line">BACKUP_DIR=/usr/local/backup/etcd</span><br><span class="line">mkdir -p $BACKUP_DIR</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">etcdctl --endpoints=https://$IP:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot save $BACKUP_DIR/snap-$(date +%Y%m%d%H%M).db</span><br><span class="line">find $BACKUP_DIR -mtime +7 |xargs rm -f</span><br><span class="line">scp $BACKUP_DIR/snap-$(date +%Y%m%d%H%M).db 192.168.67.120:/usr/local/backup/etcd/</span><br></pre></td></tr></table></figure>
<h2 id="捕鱼2应用yaml文件备份"><a href="#捕鱼2应用yaml文件备份" class="headerlink" title="捕鱼2应用yaml文件备份"></a>捕鱼2应用yaml文件备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># 该脚本放在192.168.67.119 /crond/buyu2-backup.sh，每天执行两次</span><br><span class="line">cd /usr/local/backup/buyu2/</span><br><span class="line">for name in `kubectl get deploy -n game-buyu |awk &apos;$1!~/NAME/ &#123;print $1&#125;&apos;`;do</span><br><span class="line">  kubectl -n game-buyu get deploy $&#123;name&#125; -o yaml &gt; $&#123;name&#125;-ds.yaml</span><br><span class="line">done</span><br><span class="line">for name in `kubectl get service -n game-buyu |awk &apos;$1!~/NAME/ &#123;print $1&#125;&apos;`;do</span><br><span class="line">  kubectl -n game-buyu get service $name -o yaml &gt; $&#123;name&#125;-svc.yaml</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2 id="etc-kubernetes与-var-lib-kubelet-都备份到-usr-local-backup目录下"><a href="#etc-kubernetes与-var-lib-kubelet-都备份到-usr-local-backup目录下" class="headerlink" title="/etc/kubernetes与/var/lib/kubelet/都备份到/usr/local/backup目录下"></a>/etc/kubernetes与/var/lib/kubelet/都备份到/usr/local/backup目录下</h2><h1 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h1><h2 id="kubernetes还原"><a href="#kubernetes还原" class="headerlink" title="kubernetes还原"></a>kubernetes还原</h2><h3 id="首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了-执行下列命令返回值为0"><a href="#首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了-执行下列命令返回值为0" class="headerlink" title="首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了,执行下列命令返回值为0"></a>首先需要停掉所有kube-apiserver，确保kube-apiserver已经停止了,执行下列命令返回值为0</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/kubernetes/manifests-backups</span><br><span class="line">mv /etc/kubernetes/manifests/kube-apiserver.yaml /etc/kubernetes/manifests-backups/</span><br><span class="line">ps -ef|grep kube-api|grep -v grep |wc -l</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h3 id="停掉所有etcd节点并且移除ETCD数据目录"><a href="#停掉所有etcd节点并且移除ETCD数据目录" class="headerlink" title="停掉所有etcd节点并且移除ETCD数据目录"></a>停掉所有etcd节点并且移除ETCD数据目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/lib/etcd /var/lib/etcd-bak</span><br></pre></td></tr></table></figure>
<h3 id="分别在各个节点恢复数据-首先需要拷贝数据到每个master节点"><a href="#分别在各个节点恢复数据-首先需要拷贝数据到每个master节点" class="headerlink" title="分别在各个节点恢复数据,首先需要拷贝数据到每个master节点"></a>分别在各个节点恢复数据,首先需要拷贝数据到每个master节点</h3><h3 id="所有节点etcd数据恢复"><a href="#所有节点etcd数据恢复" class="headerlink" title="所有节点etcd数据恢复"></a>所有节点etcd数据恢复</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set -x</span><br><span class="line">export ETCD_NAME=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep  -o &apos;*--name=node[0-9]*&apos; |cut -d &apos;=&apos; -f 2)</span><br><span class="line">export ETCD_CLUSTER=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep   &apos;*--initial-clustere*&apos; |awk -F &apos;--initial-cluster=&apos; &apos;&#123;print $2&#125;&apos;)</span><br><span class="line">export ETCD_INITIAL_ADVERTISE_PEER_URLS=$(cat /etc/kubernetes/manifests/etcd.yaml |egrep   &apos;*--initial-advertise-peer-urls*&apos; |awk -F &apos;--initial-advertise-peer-urls=&apos; &apos;&#123;print $2&#125;&apos;)</span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key  restore /var/lib/etcd_backup/backup_20180107172459.db \</span><br><span class="line">  --name $ETCD_NAME \</span><br><span class="line">  --data-dir /var/lib/etcd/ \</span><br><span class="line">  --initial-cluster $ETCD_CLUSTER \</span><br><span class="line">  --initial-advertise-peer-urls $ETCD_INITIAL_ADVERTISE_PEER_URLS</span><br></pre></td></tr></table></figure>
<h3 id="启动所有ETCD，健康检查"><a href="#启动所有ETCD，健康检查" class="headerlink" title="启动所有ETCD，健康检查"></a>启动所有ETCD，健康检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ETCDCTL_API=3 etcdctl --endpoints=&apos;https://127.0.0.1:2379&apos; --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key endpoint health</span><br></pre></td></tr></table></figure>
<h3 id="启动apiserver"><a href="#启动apiserver" class="headerlink" title="启动apiserver"></a>启动apiserver</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/kubernetes/manifests-backups/kube-apiserver.yaml /etc/kubernetes/manifests/</span><br><span class="line">kubectl get cs,node</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://blog.csdn.net/dazuiba008/article/details/94596017" target="_blank" rel="noopener">https://blog.csdn.net/dazuiba008/article/details/94596017</a><br><a href="https://blog.csdn.net/dazuiba008/article/details/94595980" target="_blank" rel="noopener">https://blog.csdn.net/dazuiba008/article/details/94595980</a><br><a href="https://blog.csdn.net/dazuiba008/article/details/94595451" target="_blank" rel="noopener">https://blog.csdn.net/dazuiba008/article/details/94595451</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/01/k8s/ingress-nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/01/k8s/ingress-nginx/" class="post-title-link" itemprop="url">ingress-nginx</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-01 17:06:51" itemprop="dateCreated datePublished" datetime="2019-08-01T17:06:51+08:00">2019-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-04 15:01:41" itemprop="dateModified" datetime="2019-12-04T15:01:41+08:00">2019-12-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/nginx/" itemprop="url" rel="index">
                    <span itemprop="name">nginx</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ingress"><a href="#ingress" class="headerlink" title="ingress"></a>ingress</h2><h3 id="ingress组成"><a href="#ingress组成" class="headerlink" title="ingress组成"></a>ingress组成</h3><p>ingress controller<br>　　将新加入的Ingress转化成Nginx的配置文件并使之生效<br>ingress服务<br>　　将Nginx的配置抽象成一个Ingress对象，每添加一个新的服务只需写一个新的Ingress的yaml文件即可</p>
<h3 id="Ingress-工作原理"><a href="#Ingress-工作原理" class="headerlink" title="Ingress 工作原理"></a>Ingress 工作原理</h3><ol>
<li>ingress controller通过和kubernetes api交互，动态的去感知集群中ingress规则变化，</li>
<li>然后读取它，按照自定义的规则，规则就是写明了哪个域名对应哪个service，生成一段nginx配置，</li>
<li>再写到nginx-ingress-control的pod里，这个Ingress controller的pod里运行着一个Nginx服务，控制器会把生成的nginx配置写入/etc/nginx.conf文件中，</li>
<li>然后reload一下使配置生效。以此达到域名分配置和动态更新的问题。</li>
</ol>
<h3 id="Ingress-可以解决什么问题"><a href="#Ingress-可以解决什么问题" class="headerlink" title="Ingress 可以解决什么问题"></a>Ingress 可以解决什么问题</h3><ol>
<li>动态配置服务<br>　　如果按照传统方式, 当新增加一个服务时, 我们可能需要在流量入口加一个反向代理指向我们新的k8s服务. 而如果用了Ingress, 只需要配置好这个服务, 当服务启动时, 会自动注册到Ingress的中, 不需要而外的操作.</li>
<li>减少不必要的端口暴露<br>　　配置过k8s的都清楚, 第一步是要关闭防火墙的, 主要原因是k8s的很多服务会以NodePort方式映射出去, 这样就相当于给宿主机打了很多孔, 既不安全也不优雅. 而Ingress可以避免这个问题, 除了Ingress自身服务可能需要映射出去, 其他服务都不要用NodePort方式</li>
</ol>
<h3 id="获取配置文件位置"><a href="#获取配置文件位置" class="headerlink" title="获取配置文件位置"></a>获取配置文件位置</h3><p><a href="https://github.com/kubernetes/ingress-nginx/tree/nginx-0.20.0/deploy" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx/tree/nginx-0.20.0/deploy</a></p>
<h4 id="manatory-yaml"><a href="#manatory-yaml" class="headerlink" title="manatory.yaml"></a>manatory.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir ingress-nginx</span><br><span class="line">wget  https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.20.0/deploy/mandatory.yaml</span><br><span class="line">sed -i &apos;s#k8s.gcr.io/defaultbackend-amd64#registry.cn-qingdao.aliyuncs.com/kubernetes_xingej/defaultbackend-amd64#g&apos; mandatory.yaml</span><br><span class="line">sed -i &apos;s#quay.io/kubernetes-ingress-controller/nginx-ingress-controller#registry.cn-qingdao.aliyuncs.com/kubernetes_xingej/nginx-ingress-controller#g&apos; mandatory.yaml</span><br><span class="line">kubectl apply -f manatory.yaml</span><br></pre></td></tr></table></figure>

<h4 id="service-nodeport-yaml"><a href="#service-nodeport-yaml" class="headerlink" title="service-nodeport.yaml"></a>service-nodeport.yaml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ingress-nginx]# cat service-nodeport.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: ingress-nginx</span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - name: http</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">      nodePort: 32080  #http</span><br><span class="line">    - name: https</span><br><span class="line">      port: 443</span><br><span class="line">      targetPort: 443</span><br><span class="line">      protocol: TCP</span><br><span class="line">      nodePort: 32443  #https</span><br><span class="line">  selector:</span><br><span class="line">    app.kubernetes.io/name: ingress-nginx</span><br><span class="line">    app.kubernetes.io/part-of: ingress-nginx</span><br><span class="line"></span><br><span class="line">kubectl apply -f service-nodeport.yaml </span><br><span class="line">查看状态</span><br><span class="line">kubectl -n ingress-nginx get pods,svc -o wide </span><br><span class="line">都起来后，在浏览器访问ip:port试试</span><br><span class="line">192.168.67.119:32080  返回”default backend - 404“则正常</span><br></pre></td></tr></table></figure>


<h3 id="部署后端服务"><a href="#部署后端服务" class="headerlink" title="部署后端服务"></a>部署后端服务</h3><p>kubectl apply -f nginx-dsi.yaml,本地指定<a href="http://foo.bar.com到192.168.67.119，访问http://foo.bar.com:32080" target="_blank" rel="noopener">http://foo.bar.com到192.168.67.119，访问http://foo.bar.com:32080</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1 </span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.7.9</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">    - name: http</span><br><span class="line">      port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress-nginx</span><br><span class="line">  namespace: default</span><br><span class="line">  annotations:</span><br><span class="line">    kubernets.io/ingress.class: &quot;nginx&quot;</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: foo.bar.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path:</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: nginx-svc</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure>

<h3 id="https访问"><a href="#https访问" class="headerlink" title="https访问"></a>https访问</h3><h4 id="证书创建"><a href="#证书创建" class="headerlink" title="证书创建"></a>证书创建</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out tls.key 2048</span><br><span class="line">openssl req -new -x509 -key tls.key -out tls.crt -subj /C=CN/ST=Beijing/L=Beijing/O=DevOps/CN=tomcat.magedu.com #注意域名要和服务的域名一致</span><br><span class="line">kubectl create secret tls tomcat-ingress-secret --cert=tls.crt --key=tls.key #创建secret</span><br><span class="line">kubectl get secret</span><br></pre></td></tr></table></figure>
<h4 id="模板ingress"><a href="#模板ingress" class="headerlink" title="模板ingress"></a>模板ingress</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master01 ingress]# cat ingress-tomcat-tls.yaml</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: ingress-tomcat-tls</span><br><span class="line">  namespace: default</span><br><span class="line">  annotations: </span><br><span class="line">    kubernets.io/ingress.class: &quot;nginx&quot;</span><br><span class="line">spec:</span><br><span class="line">  tls:</span><br><span class="line">  - hosts:</span><br><span class="line">    - tomcat.magedu.com        #与secret证书的域名需要保持一致</span><br><span class="line">    secretName: tomcat-ingress-secret   #secret证书的名称</span><br><span class="line">  rules:</span><br><span class="line">  - host: tomcat.magedu.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: </span><br><span class="line">        backend:</span><br><span class="line">          serviceName: tomcat</span><br><span class="line">          servicePort: 8080</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/26/k8s/%E5%88%9B%E5%BB%BA%E5%8F%AA%E8%AF%BB%E8%B4%A6%E6%88%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/26/k8s/%E5%88%9B%E5%BB%BA%E5%8F%AA%E8%AF%BB%E8%B4%A6%E6%88%B7/" class="post-title-link" itemprop="url">k8s创建只读rbac账户</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-26 18:41:48" itemprop="dateCreated datePublished" datetime="2019-07-26T18:41:48+08:00">2019-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 09:24:27" itemprop="dateModified" datetime="2019-12-11T09:24:27+08:00">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/rbac/" itemprop="url" rel="index">
                    <span itemprop="name">rbac</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="创建只读rbac账户"><a href="#创建只读rbac账户" class="headerlink" title="创建只读rbac账户"></a>创建只读rbac账户</h1><h3 id="readonly-json"><a href="#readonly-json" class="headerlink" title="readonly.json"></a>readonly.json</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;readonly&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;HangZhou&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;HangZhou&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;develop:readonly&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;develop&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ca-config-readonly-json"><a href="#ca-config-readonly-json" class="headerlink" title="ca-config-readonly.json"></a>ca-config-readonly.json</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;signing&quot;: &#123;</span><br><span class="line">        &quot;default&quot;: &#123;</span><br><span class="line">            &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;profiles&quot;: &#123;</span><br><span class="line">            &quot;kubernetes&quot;: &#123;</span><br><span class="line">                &quot;usages&quot;: [</span><br><span class="line">                    &quot;signing&quot;,</span><br><span class="line">                    &quot;key encipherment&quot;,</span><br><span class="line">                    &quot;server auth&quot;,</span><br><span class="line">                    &quot;client auth&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="下载证书制作工具"><a href="#下载证书制作工具" class="headerlink" title="下载证书制作工具"></a>下载证书制作工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -s -L -o /bin/cfssl https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span><br><span class="line">curl -s -L -o /bin/cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span><br><span class="line">curl -s -L -o /bin/cfssl-certinfo https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64</span><br><span class="line">chmod +x /bin/cfssl*</span><br></pre></td></tr></table></figure>

<h3 id="基于以Kubernetes-CA证书创建只读用户的证书-生成readonly-key-pem、readonly-pem、readonly-csr"><a href="#基于以Kubernetes-CA证书创建只读用户的证书-生成readonly-key-pem、readonly-pem、readonly-csr" class="headerlink" title="基于以Kubernetes CA证书创建只读用户的证书 生成readonly-key.pem、readonly.pem、readonly.csr"></a>基于以Kubernetes CA证书创建只读用户的证书 生成readonly-key.pem、readonly.pem、readonly.csr</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert --ca /etc/kubernetes/pki/ca.crt --ca-key /etc/kubernetes/pki/ca.key --config ca-config-readonly.json --profile=kubernetes readonly.json |cfssljson --bare readonly</span><br></pre></td></tr></table></figure>

<h3 id="创建kubeconfig"><a href="#创建kubeconfig" class="headerlink" title="创建kubeconfig"></a>创建kubeconfig</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">KUBE_API_SERVER=&quot;https://192.168.67.119:6443&quot;</span><br><span class="line">kubectl config set-cluster kubernetes --server=$&#123;KUBE_API_SERVER&#125; \</span><br><span class="line">    --certificate-authority=/etc/kubernetes/pki/ca.crt \</span><br><span class="line">    --embed-certs=true \</span><br><span class="line">    --kubeconfig=readonly.kubeconfig</span><br><span class="line">kubectl config set-credentials develop-readonly \</span><br><span class="line">    --certificate-authority=/etc/kubernetes/pki/ca.crt \</span><br><span class="line">    --embed-certs=true \</span><br><span class="line">    --client-key=readonly-key.pem \</span><br><span class="line">    --client-certificate=readonly.pem \</span><br><span class="line">    --kubeconfig=readonly.kubeconfig</span><br><span class="line">kubectl config set-context default-system --cluster=kubernetes \</span><br><span class="line">    --user=develop-readonly \</span><br><span class="line">    --kubeconfig=readonly.kubeconfig</span><br><span class="line">kubectl config use-context default-system --kubeconfig=readonly.kubeconfig</span><br></pre></td></tr></table></figure>

<h3 id="增加用于dashboard的kubeconfig方式登陆（可选）"><a href="#增加用于dashboard的kubeconfig方式登陆（可选）" class="headerlink" title="增加用于dashboard的kubeconfig方式登陆（可选）"></a>增加用于dashboard的kubeconfig方式登陆（可选）</h3><ol>
<li><p>cluster-readonly-sc.yaml，在生成的kubeconfig文件最后添加token: ${token}即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: cluster-readonly</span><br><span class="line">  namespace: kube-system</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system describe secret cluster-readonly |awk &apos;$1~/token:/ &#123;print $2&#125;&apos;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="kubectl-apply-f-readonly-clusterrole-yaml-clusterrolebinding-yaml"><a href="#kubectl-apply-f-readonly-clusterrole-yaml-clusterrolebinding-yaml" class="headerlink" title="kubectl apply -f readonly-clusterrole.yaml,clusterrolebinding.yaml"></a>kubectl apply -f readonly-clusterrole.yaml,clusterrolebinding.yaml</h3><pre><code>apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRole
metadata:
  name: cluster-readonly
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - pods
  - pods/attach
  - pods/exec
  - pods/portforward
  - pods/proxy
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - configmaps
  - endpoints
  - persistentvolumeclaims
  - replicationcontrollers
  - replicationcontrollers/scale
  - serviceaccounts
  - services
  - services/proxy
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - bindings
  - events
  - limitranges
  - namespaces/status
  - pods/log
  - pods/status
  - replicationcontrollers/status
  - resourcequotas
  - resourcequotas/status
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - deployments
  - deployments/rollback
  - deployments/scale
  - statefulsets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - autoscaling
  resources:
  - horizontalpodautoscalers
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - batch
  resources:
  - cronjobs
  - jobs
  - scheduledjobs
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  resources:
  - daemonsets
  - deployments
  - ingresses
  - replicasets
  verbs:
  - get
  - list
  - watch
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: cluster-readonly
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-readonly
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: develop:readonly
- kind: ServiceAccount
  name: cluster-readonly
  namespace: kube-system
</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/22/db/etcd/etcd-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/22/db/etcd/etcd-issue/" class="post-title-link" itemprop="url">etcd issue</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-22 18:25:50" itemprop="dateCreated datePublished" datetime="2019-07-22T18:25:50+08:00">2019-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-06 09:32:27" itemprop="dateModified" datetime="2019-12-06T09:32:27+08:00">2019-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/etcd/" itemprop="url" rel="index">
                    <span itemprop="name">etcd</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/etcd/issue/" itemprop="url" rel="index">
                    <span itemprop="name">issue</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="集群故障一个节点问题解决"><a href="#集群故障一个节点问题解决" class="headerlink" title="集群故障一个节点问题解决"></a>集群故障一个节点问题解决</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 查看故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS endpoint health</span><br><span class="line">2. 查看节点id</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member list</span><br><span class="line">3. 删除故障节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member remove 81672b0117eb8ad9</span><br><span class="line">4. 下线故障节点，并删除data目录</span><br><span class="line">systemctl stop etcd</span><br><span class="line">5. 添加新节点</span><br><span class="line">etcdctl --endpoints=$ENDPOINTS member add etcd-2 --peer-urls=http://192.168.67.202:2380</span><br><span class="line">6. 修改新节点配置文件</span><br><span class="line">/usr/local/etcd-v3.2.26-linux-amd64/conf/cluster</span><br><span class="line">CLUSTER_STATE=existing</span><br><span class="line">7. 启动新节点systemctl start etcd</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">etcdctl --endpoints=127.0.0.1:2379 --ca-file=ca.pem --cert-file=server.pem --key-file=server-key.pem member list</span><br></pre></td></tr></table></figure>
<h2 id="etcd-集群运维实践"><a href="#etcd-集群运维实践" class="headerlink" title="etcd 集群运维实践"></a>etcd 集群运维实践</h2><p><a href="https://www.kubernetes.org.cn/5021.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/5021.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/17/k8s/k8s%201.11.5%20%E5%8D%95%E4%B8%BB%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/17/k8s/k8s%201.11.5%20%E5%8D%95%E4%B8%BB%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">k8s/k8s 1.11.5 单主安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-17 17:38:05" itemprop="dateCreated datePublished" datetime="2019-07-17T17:38:05+08:00">2019-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-07-23 15:13:51" itemprop="dateModified" datetime="2019-07-23T15:13:51+08:00">2019-07-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h2><p>master 和 node都要执行该步骤</p>
<ol>
<li><p>基础环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">master: 192.168.67.109   node: 192.168.67.110</span><br><span class="line">hostnamectl set-hostname master</span><br><span class="line">cat &gt;&gt; /etc/resolv.conf &lt;&lt;EOF</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">EOF</span><br><span class="line">### 注意修改ＩＰ ###</span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">192.168.67.109 master</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>内核优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定数据盘<br>mkdir /etc/docker<br>mkdir -p /data/docker<br>需上传包目录deploy至 /data/deploy</p>
</li>
<li><p>关闭firewalld防火墙， 清空ipatbles</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">iptables -F</span><br><span class="line">iptables-save &gt; /etc/sysconfig/iptables</span><br><span class="line">systemctl stop iptables &amp;&amp; systemctl disable iptables</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="master安装"><a href="#master安装" class="headerlink" title="master安装"></a>master安装</h2><ol>
<li><p>安装docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl -ssL https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">yum -y install docker-ce-17.06.2.ce-1.el7.centos</span><br><span class="line">systemctl enable docker.service</span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;graph&quot;: &quot;/data/docker&quot;,</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://ry344jnm.mirror.aliyuncs.com&quot;,&quot;https://docker.mirrors.ustc.edu.cn&quot;, &quot;hub-mirror.c.163.com&quot;],</span><br><span class="line">  &quot;max-concurrent-downloads&quot;: 10,</span><br><span class="line">  &quot;bridge&quot;: &quot;none&quot;,</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.67.113&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装kubernetes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;&gt; /etc/yum.repos.d/kubernetes.repo </span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br><span class="line">yum -y install kubelet-1.11.5-0 kubeadm-1.11.5-0 kubectl-1.11.5-0 kubernetes-cni-0.6.0</span><br><span class="line">systemctl enable kubelet.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /data/deploy</span><br><span class="line">./dockerload.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.11.5 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12</span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line">cd /data/deploy</span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line">kubectl get cs</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装组件包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl set image deployment/kubernetes-dashboard kubernetes-dashboard=mirrorgooglecontainers/kubernetes-dashboard-amd64:v1.10.0 -n kube-system</span><br><span class="line">kubectl patch svc -n kube-system kubernetes-dashboard -p &apos;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&apos;</span><br><span class="line">kubectl create -f dashboard-admin.yaml</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="添加node节点"><a href="#添加node节点" class="headerlink" title="添加node节点"></a>添加node节点</h2><p>执行”master安装“步骤的1,2,3步，然后执行以下命令来加入集群</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.67.109:6443 --token iojvkj.1eqtapewld4i4t2p --discovery-token-ca-cert-hash sha256:195c5bcd6fadf51c39a7891b2dd9d87682f48d48ab0e7d567593ffbce225c8ec</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/docker-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/docker-install/" class="post-title-link" itemprop="url">k8s/docker-install</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:40:07" itemprop="dateCreated datePublished" datetime="2019-07-16T10:40:07+08:00">2019-07-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-from-a-package" target="_blank" rel="noopener">docker-install</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"> yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>


<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/k8s%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/k8s%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">k8s相关组件</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:31:09" itemprop="dateCreated datePublished" datetime="2019-07-16T10:31:09+08:00">2019-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 09:24:27" itemprop="dateModified" datetime="2019-12-11T09:24:27+08:00">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">组件</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="dashboard"><a href="#dashboard" class="headerlink" title="dashboard"></a>dashboard</h2><p><a href="https://github.com/kubernetes/dashboard/wiki/Accessing-Dashboard---1.7.X-and-above#kubectl-proxy" target="_blank" rel="noopener">https://github.com/kubernetes/dashboard/wiki/Accessing-Dashboard---1.7.X-and-above#kubectl-proxy</a><br>用https代替http访问<br>config文件访问<a href="https://www.cnblogs.com/klvchen/p/9963642.html" target="_blank" rel="noopener">https://www.cnblogs.com/klvchen/p/9963642.html</a></p>
<h4 id="windows-访问证书报错时-需手动制作证书"><a href="#windows-访问证书报错时-需手动制作证书" class="headerlink" title="windows 访问证书报错时 需手动制作证书"></a>windows 访问证书报错时 需手动制作证书</h4><p><a href="https://blog.csdn.net/chenleiking/article/details/81488028" target="_blank" rel="noopener">https://blog.csdn.net/chenleiking/article/details/81488028</a><br><a href="https://github.com/kubernetes/dashboard/wiki/Certificate-management" target="_blank" rel="noopener">https://github.com/kubernetes/dashboard/wiki/Certificate-management</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir tls</span><br><span class="line">openssl req -nodes -newkey rsa:2048 -keyout tls/dashboard.key -out tls/dashboard.csr -subj &quot;/C=/ST=/L=/O=/OU=/CN=kubernetes-dashboard&quot;</span><br><span class="line">openssl x509 -req -sha256 -days 365 -in tls/dashboard.csr -signkey tls/dashboard.key -out tls/dashboard.crt</span><br><span class="line">kubectl create secret generic kubernetes-dashboard-tls --from-file=tls -n kube-system</span><br><span class="line">先删除旧的secret，再重新生成， 重启pod</span><br><span class="line">kubectl -n kube-system delete secret kubernetes-dashboard-certs</span><br><span class="line">kubectl create secret generic kubernetes-dashboard-certs --from-file=&quot;tls/dashboard.crt,tls/dashboard.key&quot; -n kube-system</span><br></pre></td></tr></table></figure>


<h2 id="helm"><a href="#helm" class="headerlink" title="helm"></a>helm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">安装helm</span><br><span class="line">cd /path/to/helm-v2.13.1-linux-amd64.tar.gz/</span><br><span class="line">tar -xzvf helm-v2.13.1-linux-amd64.tar.gz</span><br><span class="line">cd linux-amd64</span><br><span class="line">cp helm /usr/local/bin</span><br><span class="line">helm init --service-account=kubernetes-dashboard-admin --skip-refresh --upgrade</span><br><span class="line">helm version</span><br><span class="line">安装监控</span><br><span class="line"> helm update repo</span><br><span class="line"> helm install stable/prometheus-operator --name prometheus-operator --namespace monitoring</span><br></pre></td></tr></table></figure>
<p> <a href="https://www.kubernetes.org.cn/5163.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/5163.html</a><br> helm详解，创建<a href="https://www.kubernetes.org.cn/3884.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/3884.html</a><br> minio <a href="https://github.com/minio/minio" target="_blank" rel="noopener">https://github.com/minio/minio</a></p>
<h2 id="coredns"><a href="#coredns" class="headerlink" title="coredns"></a>coredns</h2><ul>
<li>发展史<a href="https://www.kubernetes.org.cn/4963.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/4963.html</a></li>
<li><a href="https://coredns.io/manual/toc/#configuration" target="_blank" rel="noopener">https://coredns.io/manual/toc/#configuration</a></li>
</ul>
<h2 id="calico"><a href="#calico" class="headerlink" title="calico"></a>calico</h2><p> <a href="https://blog.csdn.net/sk1137/article/details/64798152" target="_blank" rel="noopener">https://blog.csdn.net/sk1137/article/details/64798152</a><br>    <a href="https://linux.cn/article-4609-1.html" target="_blank" rel="noopener">https://linux.cn/article-4609-1.html</a><br>下载二进制文件<a href="https://github.com/projectcalico/calico" target="_blank" rel="noopener">https://github.com/projectcalico/calico</a></p>
<h2 id="prometheus-operator"><a href="#prometheus-operator" class="headerlink" title="prometheus-operator"></a>prometheus-operator</h2><p><a href="https://grafana.com/grafana/plugins/grafana-kubernetes-app" target="_blank" rel="noopener">https://grafana.com/grafana/plugins/grafana-kubernetes-app</a><br><a href="https://www.jianshu.com/p/8e087bc1c9b2" target="_blank" rel="noopener">https://www.jianshu.com/p/8e087bc1c9b2</a><br>  grafana admin prom-operator<br>  <a href="https://www.jianshu.com/p/2fbbe767870d?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin&amp;from=groupmessage" target="_blank" rel="noopener">https://www.jianshu.com/p/2fbbe767870d?utm_campaign=haruki&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin&amp;from=groupmessage</a><br>  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fcoreos%2Fkube-prometheus" target="_blank" rel="noopener">https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fcoreos%2Fkube-prometheus</a><br>  1.11版本<a href="https://www.icode9.com/content-4-66992.html" target="_blank" rel="noopener">https://www.icode9.com/content-4-66992.html</a></p>
<h2 id="hpa"><a href="#hpa" class="headerlink" title="hpa"></a>hpa</h2><ul>
<li>HPA Controller会通过调整副本数量使得CPU使用率尽量向期望值靠近，而且不是完全相等．另外，官方考虑到自动扩展的决策可能需要一段时间才会生效：例如当pod所需要的CPU负荷过大，从而在创建一个新pod的过程中，系统的CPU使用量可能会同样在有一个攀升的过程。所以，在每一次作出决策后的一段时间内，将不再进行扩展决策。对于扩容而言，这个时间段为3分钟，缩容为5分钟。</li>
<li>HPA Controller中有一个tolerance（容忍力）的概念，它允许一定范围内的使用量的不稳定，现在默认为0.1，这也是出于维护系统稳定性的考虑。例如，设定HPA调度策略为cpu使用率高于50%触发扩容，那么只有当使用率大于55%或者小于45%才会触发伸缩活动，HPA会尽力把Pod的使用率控制在这个范围之间。</li>
<li>具体的每次扩容或者缩容的多少Pod的算法为：<pre><code>Ceil(前采集到的使用率 / 用户自定义的使用率) * Pod数量) </code></pre>每次最大扩容pod数量不会超过当前副本数量的2倍</li>
<li>kubectl autoscale deployment tomcat –max=2 –min=1 </li>
</ul>
<h2 id="tab命令不全"><a href="#tab命令不全" class="headerlink" title="tab命令不全"></a>tab命令不全</h2><p>添加命令自动补全：<br>yum install -y bash-completion<br>vim ~/.bashrc<br>添加<br>source &lt;(kubectl completion bash)</p>
<h2 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h2><p>curl -LO <a href="https://storage.googleapis.com/kubernetes-release/release/`curl" target="_blank" rel="noopener">https://storage.googleapis.com/kubernetes-release/release/`curl</a> -s <a href="https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl" target="_blank" rel="noopener">https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl</a> &amp;&amp; \</p>
<h2 id="kuboard"><a href="#kuboard" class="headerlink" title="kuboard"></a>kuboard</h2><p><a href="https://kuboard.cn/guide/example/import.html" target="_blank" rel="noopener">https://kuboard.cn/guide/example/import.html</a><br><a href="http://192.168.67.119:32567/#/namespace/game-buyu" target="_blank" rel="noopener">http://192.168.67.119:32567/#/namespace/game-buyu</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/rbac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/rbac/" class="post-title-link" itemprop="url">k8s权限认证</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:31:09" itemprop="dateCreated datePublished" datetime="2019-07-16T10:31:09+08:00">2019-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 09:23:51" itemprop="dateModified" datetime="2019-12-11T09:23:51+08:00">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/rbac/" itemprop="url" rel="index">
                    <span itemprop="name">rbac</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h2><ol>
<li>kubectl的用户认证授权 <a href="https://www.colabug.com/1183751.html" target="_blank" rel="noopener">https://www.colabug.com/1183751.html</a></li>
<li>kubeconfig <a href="https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html" target="_blank" rel="noopener">https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html</a></li>
<li>calico <a href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/" target="_blank" rel="noopener">https://docs.projectcalico.org/v3.6/getting-started/kubernetes/</a></li>
<li>Kubernetes-基于RBAC的授权 <a href="https://www.kubernetes.org.cn/4062.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/4062.html</a></li>
<li>tls <a href="https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/" target="_blank" rel="noopener">https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/</a></li>
<li>dashboard 最小权限<a href="https://www.cnblogs.com/fuyuteng/p/9501079.html" target="_blank" rel="noopener">https://www.cnblogs.com/fuyuteng/p/9501079.html</a></li>
<li>官方文档<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/access-authn-authz/rbac/</a></li>
</ol>
<h3 id="创建持续部署权限"><a href="#创建持续部署权限" class="headerlink" title="创建持续部署权限"></a>创建持续部署权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: deploy</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: Group</span><br><span class="line">  name: develop:deploy</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: deploy</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&quot;&quot;, &quot;extensions&quot;, &quot;apps&quot;]</span><br><span class="line">  resources: [&quot;deployments&quot;, &quot;replicasets&quot;, &quot;pods&quot;, &quot;pods/log&quot;, &quot;deployments/rollback&quot;]</span><br><span class="line">  verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">k8s/二进制安装</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:31:09" itemprop="dateCreated datePublished" datetime="2019-07-16T10:31:09+08:00">2019-07-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><p><a href="https://www.kubernetes.org.cn/5025.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/5025.html</a>  在测试机上部署了第二遍  完美</p>
</li>
<li><p>通讯加密和认证 <a href="https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/" target="_blank" rel="noopener">https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/</a></p>
</li>
<li><p>calico BGP边界网关协议 <a href="http://baijiahao.baidu.com/s?id=1603988891006483361&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">http://baijiahao.baidu.com/s?id=1603988891006483361&amp;wfr=spider&amp;for=pc</a></p>
<h3 id="kubernetes认证授权机制"><a href="#kubernetes认证授权机制" class="headerlink" title="kubernetes认证授权机制"></a>kubernetes认证授权机制</h3><p><a href="https://www.jianshu.com/p/bb973ab1029b" target="_blank" rel="noopener">https://www.jianshu.com/p/bb973ab1029b</a></p>
</li>
<li><p>coredns  <a href="https://my.oschina.net/u/2306127/blog/1788566" target="_blank" rel="noopener">https://my.oschina.net/u/2306127/blog/1788566</a></p>
</li>
<li><p>核心概念总结<a href="https://www.cnblogs.com/zhenyuyaodidiao/p/6500720.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhenyuyaodidiao/p/6500720.html</a></p>
</li>
<li><p>ipvs <a href="https://www.kubernetes.org.cn/3025.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/3025.html</a></p>
</li>
<li><p>ingress <a href="https://www.kubernetes.org.cn/4291.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/4291.html</a></p>
</li>
<li><p>efk <a href="https://www.kubernetes.org.cn/4278.html" target="_blank" rel="noopener">https://www.kubernetes.org.cn/4278.html</a></p>
</li>
<li><p>iptables -t nat -A PREROUTING -i bond0 -p tcp -m tcp –dport 80 -j DNAT –to-destination 10.10.0.201:80</p>
</li>
</ul>
<h2 id="安装前升级内核-参考第一二条链接"><a href="#安装前升级内核-参考第一二条链接" class="headerlink" title="安装前升级内核  参考第一二条链接"></a>安装前升级内核  参考第一二条链接</h2><ul>
<li>先清除旧数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/systemd/system/docker*</span><br><span class="line">rm -f /etc/yum.repos.d/wise2c.repo</span><br><span class="line">rm -f /etc/yum.repos.d/docker*</span><br><span class="line">rm -rf /etc/docker/</span><br></pre></td></tr></table></figure>
<ul>
<li>升级内核</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s/SELINUX=*/SELINUX=disabled/&apos; /etc/selinux/config</span><br><span class="line"></span><br><span class="line">systemctl disable firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line">swapoff -a &amp;&amp; echo &quot;vm.swappiness=0&quot; &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p &amp;&amp; free –h</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">rpm -Uvh *.rpm</span><br><span class="line">grub2-set-default 0</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<h1 id="vim-etc-sysctl-conf"><a href="#vim-etc-sysctl-conf" class="headerlink" title="vim /etc/sysctl.conf"></a>vim /etc/sysctl.conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/16/k8s/gluster-k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xujingbin">
      <meta itemprop="description" content="个人运维笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="运维笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/16/k8s/gluster-k8s/" class="post-title-link" itemprop="url">k8s glusterfs</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-16 10:31:09" itemprop="dateCreated datePublished" datetime="2019-07-16T10:31:09+08:00">2019-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-11 09:24:27" itemprop="dateModified" datetime="2019-12-11T09:24:27+08:00">2019-12-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index">
                    <span itemprop="name">k8s</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/glusterfs/" itemprop="url" rel="index">
                    <span itemprop="name">glusterfs</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://www.cnblogs.com/yourarebest/p/9629521.html" target="_blank" rel="noopener">https://www.cnblogs.com/yourarebest/p/9629521.html</a></p>
<h3 id="静态手动管理glusterfs"><a href="#静态手动管理glusterfs" class="headerlink" title="静态手动管理glusterfs"></a>静态手动管理glusterfs</h3><h4 id="手动创建pvc-这种方式提示手动创建storageclass，但是只有动态创建的storageclass"><a href="#手动创建pvc-这种方式提示手动创建storageclass，但是只有动态创建的storageclass" class="headerlink" title="手动创建pvc,这种方式提示手动创建storageclass，但是只有动态创建的storageclass"></a>手动创建pvc,这种方式提示手动创建storageclass，但是只有动态创建的storageclass</h4><ol>
<li>创建GlusterFS卷</li>
<li>Kubernetes创建PV等存储:gfs-svc gfs-ep gfs-pv </li>
<li>Kubernetes创建应用 gfs-pvc pod<blockquote>
<p>这种方式是手动管理volume。假设在k8s上部署一个使用gluster存储的应用，如果使用之前应用的volume，能看到其他应用的数据，多个应用之间的数据应该是隔离的，也就是权限问题，同时，大概率导致文件命名冲突问题。pv(c)中设置的容量capacity也无法控制。基本上处于不可用。 <a href="http://rdc.hundsun.com/portal/article/826.html" target="_blank" rel="noopener">http://rdc.hundsun.com/portal/article/826.html</a></p>
</blockquote>
</li>
</ol>
<h4 id="通过”endpoints”-“glusterfs-cluster”-path”-“gv0”"><a href="#通过”endpoints”-“glusterfs-cluster”-path”-“gv0”" class="headerlink" title="通过”endpoints”: “glusterfs-cluster”,path”: “gv0”,"></a>通过”endpoints”: “glusterfs-cluster”,path”: “gv0”,</h4><p><a href="https://github.com/kubernetes/examples/blob/master/staging/volumes/glusterfs/glusterfs-pod.json" target="_blank" rel="noopener">https://github.com/kubernetes/examples/blob/master/staging/volumes/glusterfs/glusterfs-pod.json</a></p>
<h4 id="直接通过-brickrootPaths-“172-16-2-131-tmp-172-16-2-132-tmp”‘"><a href="#直接通过-brickrootPaths-“172-16-2-131-tmp-172-16-2-132-tmp”‘" class="headerlink" title="直接通过 brickrootPaths: “172.16.2.131:/tmp/,172.16.2.132:/tmp”‘"></a>直接通过 brickrootPaths: “172.16.2.131:/tmp/,172.16.2.132:/tmp”‘</h4><p><a href="https://github.com/kubernetes-incubator/external-storage/tree/master/gluster/glusterfs" target="_blank" rel="noopener">https://github.com/kubernetes-incubator/external-storage/tree/master/gluster/glusterfs</a></p>
<h3 id="通过heketi来动态管理glusterfs"><a href="#通过heketi来动态管理glusterfs" class="headerlink" title="通过heketi来动态管理glusterfs"></a>通过heketi来动态管理glusterfs</h3><h3 id="gluster"><a href="#gluster" class="headerlink" title="gluster"></a>gluster</h3><p><a href="https://github.com/gluster/gluster-kubernetes/blob/master/docs/setup-guide.md" target="_blank" rel="noopener">https://github.com/gluster/gluster-kubernetes/blob/master/docs/setup-guide.md</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">modprobe dm_snapshot</span><br><span class="line">modprobe dm_mirror</span><br><span class="line">modprobe dm_thin_pool</span><br><span class="line"></span><br><span class="line">sudo wipefs -af /dev/sdb</span><br><span class="line">dmsetup ls</span><br><span class="line">dmsetup remove ddf1_44656c6c202020201000007910281f1747cd0dedccd25148</span><br><span class="line">dmsetup remove_all</span><br><span class="line">./gk-deploy -g --abort</span><br><span class="line"></span><br><span class="line">./gk-deploy -gv --single-node</span><br></pre></td></tr></table></figure>
<h3 id="heketi"><a href="#heketi" class="headerlink" title="heketi"></a>heketi</h3><p>/bin/kubectl -n default exec -i heketi-85dbbbb55-78df9 – heketi-cli -s <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> –user admin –secret ‘’ volume list</p>
<h3 id="pvc"><a href="#pvc" class="headerlink" title="pvc"></a>pvc</h3><p><a href="https://www.jianshu.com/p/99e610067bc8" target="_blank" rel="noopener">https://www.jianshu.com/p/99e610067bc8</a><br>storageclass <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></p>
<h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><p>mount -t glusterfs 10.105.94.239:vol_fef6bc590cb2a3c8c1df0d72e91a5146 /gfs-promotion/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行kubectl get pv pvc-bd0960f3-7881-11e9-a9d4-c81f66c0e5c3 -o yaml获得</span><br><span class="line">1. spec.glusterfs.path: vol_fef6bc590cb2a3c8c1df0d72e91a5146</span><br><span class="line">2. spec.glusterfs.endpoints: 10.105.94.239</span><br></pre></td></tr></table></figure>

<h2 id="pv挂载"><a href="#pv挂载" class="headerlink" title="pv挂载"></a>pv挂载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">- name: cache-volume</span><br><span class="line">  emptyDir: &#123;&#125;</span><br><span class="line">- name: test-volume</span><br><span class="line">  hostPath:</span><br><span class="line">    # directory location on host</span><br><span class="line">    path: /data</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xujingbin</p>
  <div class="site-description" itemprop="description">个人运维笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">83</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xujingbin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0
  </div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

</body>
</html>
